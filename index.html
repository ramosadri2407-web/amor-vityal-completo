<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Laberinto ‚Äî P1</title>

<style>
  body{
    background:#000;
    color:#fff;
    font-family:Arial;
    margin:0;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
  }
  .menu, .game-container{
    text-align:center;
  }
  .btn{
    padding:12px 20px;
    background:white;
    color:black;
    border:none;
    font-size:20px;
    margin:10px;
    border-radius:6px;
    cursor:pointer;
    font-weight:bold;
  }
  canvas{
    border:5px solid white;
    background:black;
  }
  #backBtn{
    position:fixed;
    top:20px;
    left:20px;
    padding:10px 18px;
    font-size:16px;
    display:none;
  }

  /* === CONTROLES T√ÅCTILES === */
  #controls {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    width: 300px;
    height: 300px;
  }

  #btn-up{
    position: absolute;
    top: 35%;
    left: 30%;
    transform: translateX(100%);
    width:60px;
    height:30px;
    font-size:22px;
    border-radius:10px;
    background:rgba(255,255,255,0.20);
    color:white;
    border:1px solid rgba(255,255,255,0.4);
    backdrop-filter: blur(6px);
    display:flex;
    justify-content:center;
    align-items:center;
  }

  #btn-left{
    position:absolute;
    top: 35%;
    left: 70px;
    transform: translateY(100%);
    width:60px;
    height:30px;
    font-size:24px;
    border-radius:50%;
    background:rgba(0,0,0,0.45);
    color:#00eaff;
    border:2px solid #00eaff;
    display:flex;
    justify-content:center;
    align-items:center;
  }

  #btn-right{
    position:absolute;
    top: 35%;
    right: 20px;
    transform: translateY(100%);
    width:60px;
    height:30px;
    font-size:26px;
    border-radius:14px;
    background:rgba(255,255,255,0.10);
    color:#ffd700;
    border:1px solid #ffd700;
    box-shadow:0 0 8px #ffd700;
    display:flex;
    justify-content:center;
    align-items:center;
  }

  #btn-down{
    position:absolute;
    bottom: 35%;
    left: 30%;
    transform: translateX(100%);
    width:60px;
    height:30px;
    font-size:22px;
    border-radius:12px;
    background:rgba(255,0,90,0.30);
    color:white;
    border:1px solid rgba(255,0,90,0.6);
    backdrop-filter: blur(8px);
    display:flex;
    justify-content:center;
    align-items:center;
  }

  #controls-row{
    display:flex;
    justify-content:center;
  }
  .ctrl-btn{
    cursor:pointer;
    user-select:none;
  }

  /* === GAME OVER PIXEL === */
  #gameOverBox {
    position: fixed;
    top:0; left:0; right:0; bottom:0;
    display:none;
    justify-content:center;
    align-items:center;
    background:rgba(0,0,0,0.65);
    z-index:9999;
  }

  #gameOverText{
    font-family: "Press Start 2P", monospace;
    font-size:40px;
    color:#ff0040;
    text-shadow: 0 0 10px #ff0040;
  }

  @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
</style>
</head>

<body>

<!-- ================= PORTADA TEMPORAL ================= -->
<div id="portadaTemp" style="
  position:fixed;
  top: 0;; left:0;
  width:100%; height:100%;
  background: linear-gradient(120deg, #1b1b2f, #162447, #1f4068, #e43f5a);
  background-size:300% 300%;
  animation: portadaGradient 10s ease infinite;
  display:flex;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  font-family:'Dancing Script', cursive;
  color:white;
  text-align:center;
  z-index:999999;
">

 <h1 style="
  position:absolute;
  top:10px;
  left:50%;
  transform:translateX(-50%);
  font-size:3rem;
  text-shadow:0 0 20px rgba(255,255,255,0.7);
">
  üíå Amor Virtual üíå
</h1>

  <p style="font-size:2rem; width:80%; margin-top:20px;">
    Completa los pr√≥ximos desaf√≠os para ver el contenido
  </p>

</div>

<style>
@keyframes portadaGradient {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}
</style>

<!-- ================= MENU ================ -->
<div id="menu" class="menu">
  <h1>Elige un Jugador</h1>
  <button class="btn" onclick="startGame('P1')">Jugar P1</button>
</div>

<!-- ================= JUEGO ================ -->
<div id="game" class="game-container" style="display:none;">
  <h2 id="label"></h2>
  <canvas id="canvas" width="560" height="520"></canvas>
</div>

<button id="backBtn" class="btn" onclick="volverMenu()">Volver</button>

<!-- ============= CONTROLES T√ÅCTILES ============= -->
<div id="controls">
  
  <button id="btn-up" class="ctrl-btn" onclick="touchMove('up')">‚ñ≤</button>

  <div id="controls-row">
    <button id="btn-left" class="ctrl-btn" onclick="touchMove('left')">‚óÄ</button>
    <button id="btn-right" class="ctrl-btn" onclick="touchMove('right')">‚ñ∂</button>
  </div>

  <button id="btn-down" class="ctrl-btn" onclick="touchMove('down')">‚ñº</button>

</div>

<!-- ====== GAME OVER POPUP ====== -->
<div id="gameOverBox">
    <div id="gameOverText">GAME<br>OVER</div>
</div>

<script>

/* ======================= FADE ====================== */
function fadeOut(callback){
    const fade = document.createElement("div");
    fade.id = "fadeLayer";
    fade.style.position = "fixed";
    fade.style.top = 0;
    fade.style.left = 0;
    fade.style.width = "100%";
    fade.style.height = "100%";
    fade.style.background = "black";
    fade.style.opacity = 0;
    fade.style.transition = "opacity 0.3s";
    fade.style.zIndex = 99999;
    document.body.appendChild(fade);

    setTimeout(()=> fade.style.opacity = 1, 10);

    setTimeout(()=>{
        callback();
        fade.style.opacity = 0;
        setTimeout(()=> fade.remove(), 300);
    }, 350);
}

/* ======================= MAZE CLASS ========================== */
class Maze {
  constructor(cols, rows, cellSize, offset){
    this.cols=cols; 
    this.rows=rows;
    this.s=cellSize;
    this.o=offset;
    this.grid=[];
    this.stack=[];
    this.gen();
  }

  gen(){
    for(let y=0;y<this.rows;y++){
      const row=[];
      for(let x=0;x<this.cols;x++){
        row.push({x,y,w:[true,true,true,true],v:false});
      }
      this.grid.push(row);
    }

    let current=this.grid[0][0];
    current.v=true;
    this.stack=[current];

    while(this.stack.length){
      let c=this.stack[this.stack.length-1];
      let n=this.unv(c);
      if(n){
        n.v=true;
        this.rm(c,n);
        this.stack.push(n);
      } else this.stack.pop();
    }
  }

  unv(c){
    let {x,y}=c;
    let ns=[];
    if(y>0 && !this.grid[y-1][x].v) ns.push(this.grid[y-1][x]);
    if(x<this.cols-1 && !this.grid[y][x+1].v) ns.push(this.grid[y][x+1]);
    if(y<this.rows-1 && !this.grid[y+1][x].v) ns.push(this.grid[y+1][x]);
    if(x>0 && !this.grid[y][x-1].v) ns.push(this.grid[y][x-1]);
    if(!ns.length) return null;
    return ns[Math.floor(Math.random()*ns.length)];
  }

  rm(a,b){
    let dx=a.x-b.x, dy=a.y-b.y;
    if(dx===1){ a.w[3]=false; b.w[1]=false; }
    if(dx===-1){ a.w[1]=false; b.w[3]=false; }
    if(dy===1){ a.w[0]=false; b.w[2]=false; }
    if(dy===-1){ a.w[2]=false; b.w[0]=false; }
  }

  draw(ctx){
    ctx.strokeStyle="#fff";
    ctx.lineWidth=6;

    const s=this.s, o=this.o;

    for(let y=0;y<this.rows;y++){
      for(let x=0;x<this.cols;x++){
        let c=this.grid[y][x];
        let px=o+x*s;
        let py=o+y*s;

        if(c.w[0]){ ctx.beginPath(); ctx.moveTo(px,py); ctx.lineTo(px+s,py); ctx.stroke(); }
        if(c.w[1]){ ctx.beginPath(); ctx.moveTo(px+s,py); ctx.lineTo(px+s,py+s); ctx.stroke(); }
        if(c.w[2]){ ctx.beginPath(); ctx.moveTo(px+s,py+s); ctx.lineTo(px,py+s); ctx.stroke(); }
        if(c.w[3]){ ctx.beginPath(); ctx.moveTo(px,py+s); ctx.lineTo(px,py); ctx.stroke(); }
      }
    }
  }

  isFree(px,py){
    const s=this.s,o=this.o;
    const maxX=o+this.cols*s,maxY=o+this.rows*s;
    if(px<o+4 || py<o+4 || px>maxX-4 || py>maxY-4) return false;

    let cx=Math.floor((px-o)/s);
    let cy=Math.floor((py-o)/s);
    if(cx<0||cy<0||cx>=this.cols||cy>=this.rows) return false;

    let c=this.grid[cy][cx];
    let lx=px-(o+cx*s), ly=py-(o+cy*s);
    let pad=5;

    if(c.w[0]&&ly<=pad) return false;
    if(c.w[2]&&ly>=s-pad) return false;
    if(c.w[3]&&lx<=pad) return false;
    if(c.w[1]&&lx>=s-pad) return false;

    return true;
  }
}

/* ================= GAME STATE ==================== */
let maze, ctx, cvs;
let player={x:0,y:0,color:"#0f0",r:7};
let playing=null;
let finishedP1=false;
let goalX, goalY;
let running=false;

const cols=21, rows=17, cellSize=22, offset=14;

/* ============== GAME START ====================== */
function startGame(p){

  running = false;

  fadeOut(()=>{

    document.getElementById("menu").style.display="none";
    document.getElementById("game").style.display="block";
    document.getElementById("controls").style.display="block";

    playing=p;
    document.getElementById("label").innerHTML="Jugador " + p;

    cvs=document.getElementById("canvas");
    ctx=cvs.getContext("2d");

    maze=new Maze(cols,rows,cellSize,offset);

    player.x=offset+cellSize/2;
    player.y=offset+cellSize/2;
    player.color="#00e676";
    goalX=offset+(cols-1)*cellSize+cellSize/2;
    goalY=offset+(rows-1)*cellSize+cellSize/2;

    if(!running){
      running=true;
      update();
    }
  });
}

/* ============= DIBUJO ================ */
function draw(){
  ctx.fillStyle="black";
  ctx.fillRect(0,0,cvs.width,cvs.height);

  maze.draw(ctx);

  ctx.fillStyle="yellow";
  ctx.beginPath();
  ctx.arc(goalX,goalY,8,0,Math.PI*2);
  ctx.fill();

  ctx.fillStyle=player.color;
  ctx.beginPath();
  ctx.arc(player.x,player.y,player.r,0,Math.PI*2);
  ctx.fill();
}

/* ============= MOVIMIENTO =============== */
let keys={};
document.addEventListener("keydown",e=>keys[e.key]=true);
document.addEventListener("keyup",e=>keys[e.key]=false);

function touchMove(dir){
  keys={};
  keys["Arrow"+dir.charAt(0).toUpperCase()+dir.slice(1)] = true;
  setTimeout(()=>keys={},120);
}

function move(){
  let sp=2.3, dx=0, dy=0;

  if(keys["ArrowUp"]) dy-=sp;
  if(keys["ArrowDown"]) dy+=sp;
  if(keys["ArrowLeft"]) dx-=sp;
  if(keys["ArrowRight"]) dx+=sp;

  if(dx&&dy){ dx*=0.7; dy*=0.7; }

  let nx=player.x+dx, ny=player.y+dy;
  if(maze.isFree(nx,ny)){ player.x=nx; player.y=ny; }

  if(Math.hypot(player.x-goalX,player.y-goalY) < 12){
    ganaste();
  }
}

/* ============= LOOP ================== */
function update(){
  if(!running) return;
  move();
  draw();
  requestAnimationFrame(update);
}

/* ============= GANASTE SOLO P1 ============== */
function ganaste(){

  if(navigator.vibrate){
    navigator.vibrate([200, 100, 200]);
  }

  const box = document.getElementById("gameOverBox");
  const text = document.getElementById("gameOverText");

  text.innerHTML = "DISFRUTA";
  text.style.color = "#00ffea";
  text.style.textShadow = "0 0 15px #00fff2";

  box.style.display = "flex";
  box.style.opacity = "1";

  finishedP1 = true;

  setTimeout(()=>{
      window.location.href = "welcome.html";
  }, 1500);

}

/* ====== OCULTAR PORTADA TEMPORAL ====== */
window.onload = () => {
  const portada = document.getElementById("portadaTemp");
  setTimeout(() => {
    portada.style.transition = "opacity 3s";
    portada.style.opacity = "0";
    setTimeout(() => portada.remove(), 5000);
  }, 5000);
};

</script>

</body>
</html>


